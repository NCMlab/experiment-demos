<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="description" content="jsPsych Test NCMLab">
    <meta name="keywords" content="HTML, CSS, JavaScript">
    <meta name="author" content="Jason Steffener, NCMLab">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Questionnaire</title>
    <script src="jspsych/jspsych.js"></script>
    <script src="jspsych/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="jspsych/plugins/jspsych-image-keyboard-response.js"></script>
    <script src="jspsych/plugins/jspsych-fullscreen.js"></script>
    <script src="jspsych/plugins/jspsych-instructions.js"></script>    
    <script src="jspsych/plugins/jspsych-survey-likert.js"></script>
    <link href="jspsych/css/jspsych.css" rel="stylesheet" type="text/css">
    <link href="LikertQuestionnaires.css" rel="stylesheet">
    <script src="panas.js"></script>
    <script src="jatos.js"></script>

  </head>
  <script>



    var Test = {
        type: 'survey-likert',
        questions: items,
        preamble: instructions,
        on_finish: function(data){
          // The responses to each question on a likert scale are stored in an Object
          // cycle over the object and find the key and values for each
          var Sum = 0;
          var count = 0;
          // cycle over each entry in teh object that holds the likert scale and responses
          for (const [key, value] of Object.entries(jsPsych.data.getLastTrialData().values()[0].response)) 
            {   
                // Check to see if the scoring for this items should be reveresed
                if (ReverseScoreDirection[count])
                {
                    Sum += ScaleSize - value
                }
                else 
                {
                    Sum += value + 1
                }
                // If there are no reversals of the scoring then allow the entry of a single flag instead of a full array 
                if (ReverseScoreDirection.length > 1)
                {
                    count += 1      
                }
            }
          console.log("Sum = "+Sum)
        }
    };

      
    var timeline = [];
    timeline.push(Test)

    jatos.onLoad(function() {
        jsPsych.init({
            experiment_width: 600,       
            timeline: timeline,
            on_finish: function() {
                var resultsJson = jsPsych.data.get().json();
                jatos.submitResultData(resultsJson, jatos.startNextComponent);
            }
        });
    });

    </script>
</html>