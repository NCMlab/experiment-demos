<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="description" content="jsPsych Trail Making Task: A">
    <meta name="keywords" content="HTML, CSS, JavaScript">
    <meta name="author" content="Jason Steffener, NCMLab">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trailmaking Task A</title>
    <script src="jspsych/dist/jspsych.js"></script>
    <script src="jspsych/dist/plugin-html-keyboard-response.js"></script>
    <script src="jspsych/dist/plugin-image-keyboard-response.js"></script>
    <script src="jspsych/dist/plugin-fullscreen.js"></script>
    <script src="jspsych/dist/plugin-instructions.js"></script>
    <script src="jspsych/dist/plugin-fullscreen.js"></script>
    <script src="jspsych/dist/plugin-browser-check.js"></script>
    <script src="jspsych/dist/plugin-survey-text.js"></script>
    <script src="TrailMaking_Setup_EN.js"></script>
    <script src="TrailMaking_Setup_A.js"></script>
    <script src="plugin-sketchpad-trailmaking.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/jspsych@7.1.2/css/jspsych.css" />
    <style>
      .stimulus { font-size: StimulusFontSize; }
    </style>

  </head>
  <script>
  var jsPsych = initJsPsych({
      //on_finish: () => {
        //jsPsych.data.displayData();
      //}
    });
  timeline = [];


  var enter_fullscreen = {
    type: jsPsychFullscreen,
    fullscreen_mode: true
  }

  var exit_fullscreen = {
    type: jsPsychFullscreen,
    fullscreen_mode: false,
    delay_after: 0,
    on_start: function() {
      var imageData = jsPsych.data.get().last(1).values()[0].png;

      var a = document.createElement('a');
      a.href = imageData; //make the link of image
      a.download = "TrailsA.png";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }
  }

  var ScreenHeight = screen.height
  // adjust the height to make room for the counter and the finished button
  ScreenHeight = ScreenHeight - 80 - 80
  var ScreenWidth = screen.width


  /* Check the canvas size and adjust as needed */
  // is suggested size SMALLER than the full screen?
  ratio = SuggestedWidth/SuggestedHeight
  var EnoughWidth = ScreenWidth > SuggestedWidth
  var EnoughHeight = ScreenHeight > SuggestedHeight
  
  // if there is not enough height use the max and adjust the width based on the ratio
  
  CanvasWidth = SuggestedWidth
  CanvasHeight = SuggestedHeight
  
  if ( ! EnoughWidth  &&  ! EnoughHeight ) {
    // check if screen is portrair or landscape
    if ( ScreenWidth > ScreenHeight) {
      // landscape -- use height adjust width
      CanvasWidth = ScreenHeight * ratio
    }
    else {
      // portrait
      CanvasHeight = ScreenWidth / ratio
    }
  }
  if ( ! EnoughWidth  &&  EnoughHeight ) {
    CanvasWidth = ScreenWidth
    CanvasHeight = ScreenWidth / ratio
  }

  if ( ! EnoughHeight  &&  EnoughWidth ) {
    CanvasHeight = ScreenHeight
    CanvasWidth = ScreenHeight * ratio
  }


// This downloads the image as a PNG file
  var label = {
    type: jsPsychSurveyText,
    preamble: () => {
      var imageData = jsPsych.data.get().last(1).values()[0].png;

      var a = document.createElement('a');
      a.href = imageData; //make the link of image
      a.download = "TrailsA.png";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      //return `<img src="${imageData}"></img>`;

    },
    questions: [
      {prompt: 'What animal did you draw?'}
    ]
}




  //timeline.push(trial333)
  timeline.push(enter_fullscreen)
  var trial = {
      type: jsPsychSketchpad,
      
      prompt_location: 'JASON',
      canvas_width: CanvasWidth,
      canvas_height: CanvasHeight,
      canvas_border_width: 1,
      stroke_width: pen_width,
      save_final_image: true,
      save_strokes: false,
      show_clear_button: false,
      show_undo_button: false,
      show_redo_button: false,
    }

  timeline.push(trial)
  //timeline.push(label)
  timeline.push(exit_fullscreen)
  jsPsych.run(timeline)

    //});
  </script>
</html>